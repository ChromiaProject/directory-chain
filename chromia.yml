definitions:
  common.init: &common_init
    initial_provider: ${INITIAL_PROVIDER:-03ECD350EEBC617CBBFBEF0A1B7AE553A748021FD65C7C50C5ABB4CA16D4EA5B05}
    genesis_node:
      - ${GENESIS_NODE:-0350fe40766bc0ce8d08b3f5b810e49a8352fdd458606bd5fafe5acdcdc8ff3f57}
      - ${GENESIS_HOST_NAME:-localhost}
      - 9870
      - ${GENESIS_API_URL:-http://localhost:7740}
      - ${GENESIS_TERRITORY}
  config: &common_config
    config_consensus_strategy: HEADER_HASH
    blockstrategy:
      maxblocktime: 2000
    revolt:
      fast_revolt_status_timeout: 2000
    signers:
      - x"0350fe40766bc0ce8d08b3f5b810e49a8352fdd458606bd5fafe5acdcdc8ff3f57"
    sync_ext:
      - "net.postchain.d1.icmf.IcmfReceiverSynchronizationInfrastructureExtension"
    gtx:
      modules:
        - "net.postchain.d1.icmf.IcmfReceiverGTXModule"
    icmf:
      receiver:
        anchoring:
          topics:
            - G_configuration_updated
            - G_configuration_failed
  proposal_blockchain.util: &proposal_blockchain_util
    max_config_path_depth: 10
    max_config_size: 2097152 # 2 MiB

blockchains:
  manager:
    module: management_chain_directory1
    config: *common_config
    moduleArgs:
      common.init: *common_init
      common:
        allow_blockchain_dependencies: false
      proposal_blockchain.util: *proposal_blockchain_util
  devnet:
    module: management_chain_testnet
    config: *common_config
    moduleArgs:
      common.init: *common_init
      common:
        allow_blockchain_dependencies: false
      auth_service:
        pubkey: x"02B6F2967CF9AFC4D289EF475A2C2DDEC9EAB79AC60C1C99683E3134074619E635"
        include_system_cluster: true
      housekeeping:
        # 48h
        max_empty_container_time: 172800000
      proposal_blockchain.util: *proposal_blockchain_util
  mainnet:
    module: management_chain_mainnet
    config:
      << : *common_config
      gtx:
        modules:
          - "net.postchain.d1.icmf.IcmfSenderGTXModule"
          - "net.postchain.d1.icmf.IcmfReceiverGTXModule"
      icmf:
        receiver:
          anchoring:
            topics:
              - G_configuration_updated
              - G_configuration_failed
          global:
            topics:
              - G_create_container
              - G_upgrade_container
              - G_stop_container
              - G_restart_container
    moduleArgs:
      common.init: *common_init
      common:
        allow_blockchain_dependencies: false
      proposal_blockchain.util: *proposal_blockchain_util
  system_anchoring:
    module: anchoring_chain_system
    config:
      config_consensus_strategy: HEADER_HASH
      blockstrategy:
        maxblocktime: 300000
        name: "net.postchain.d1.anchoring.AnchoringBlockBuildingStrategy"
      revolt:
        fast_revolt_status_timeout: 2000
      gtx:
        modules:
          - "net.postchain.d1.anchoring.system.SystemAnchoringGTXModule"
          - "net.postchain.d1.icmf.IcmfSenderGTXModule"
  cluster_anchoring:
    module: anchoring_chain_cluster
    config:
      config_consensus_strategy: HEADER_HASH
      blockstrategy:
        maxblocktime: 300000
        name: "net.postchain.d1.anchoring.AnchoringBlockBuildingStrategy"
      revolt:
        fast_revolt_status_timeout: 2000
      gtx:
        modules:
          - "net.postchain.d1.anchoring.cluster.ClusterAnchoringGTXModule"
          - "net.postchain.d1.icmf.IcmfSenderGTXModule"
  ticket_chain:
    module: ticket_chain
    config:
      config_consensus_strategy: HEADER_HASH
      revolt:
        fast_revolt_status_timeout: 2000
      sync_ext:
        - "net.postchain.d1.icmf.IcmfReceiverSynchronizationInfrastructureExtension"
      gtx:
        modules:
          - "net.postchain.d1.icmf.IcmfReceiverGTXModule"
          - "net.postchain.d1.icmf.IcmfSenderGTXModule"
      icmf:
        receiver:
          directory-chain:
            topics:
              - L_ticket_result
    moduleArgs:
      lib.ft4.accounts:
        rate_limit_active: 1
        rate_limit_max_points: 20
        rate_limit_recovery_time: 5000
        rate_limit_points_at_account_creation: 1
      lib.auth:
        # TODO set proper pubkey for auth-server-ft4
        auth_pubkey: x"0317FF1ECF25B04026B6F9FA1960BA58070FB1CFC98519F7BC02D71ED1B00B1997"
      ticket_chain:
        asset_name: "Chromia Test"
        asset_symbol: "tCHR"
        asset_decimals: 6
        asset_icon: "https://s3.eu-central-1.amazonaws.com/www.chromiadev.net/assets/tCHR.png"
        amount_to_mint: 1000000000
        # TODO set proper pool account pubkey,
        # corresponding private key for this test key is FD8F9D4F1327DA6622B969DDD835CB41C982FAA805E614D7F4F4F0ADBCAD135F
        pool_account_pubkey: x"032FF500E33BC4DF87C7F40C167ADA6DBE52955066DD3F689189ED221B913BFD8F"
        # TODO set proper pubkey for admin
        admin_pubkey: x"0317AC5B309A05B81A68F1A64321A3C6E6799E037C12892838682EBB9A620316A6"
    test:
      modules:
        - ticket_chain.test
      moduleArgs:
        lib.ft4.accounts:
          rate_limit_active: 0
        lib.auth:
          auth_pubkey: x"03284C73391D6FFA90FA95D95BC4F29015C0111A655A9EE6DD7DEC089F32F04B5F" # Only for tests
        ticket_chain:
          admin_pubkey: x"02BECC5AA3AC14320BD9DAB1F558F637CFFE39508DEE9F7C2161EDF13A14BACE44" # Only for tests
        ticket_chain.test.ticket_chain_test:
          auth_privkey: x"B563C2BCC29FD0E014FBFC4AF3A69CB6C513C1943DB9A91093886DE18DCBE6C6"  # Only for tests
          admin_privkey: x"D223C1BEF057A86FCB4603BF8CCBF7FFBFAF1F1928ADBD52A8FCCD08E3C487C3"  # Only for tests

database: # Used for running tests
  logSqlErrors: true
  schema: chain0test
  driver: org.postgresql.Driver

test:
  modules:
    - anchoring_chain_common.test
    - anchoring_chain_system.test
    - cluster_class.test
    - common.test
    - common.queries.test
    - direct_cluster.test
    - direct_container.test
    - nm_api.test
    - proposal.test
    - proposal.voting.test
    - proposal_blockchain.test
    - proposal_blockchain_import.test
    - proposal_blockchain_move.test
    - proposal_cluster.test
    - proposal_cluster_anchoring.test
    - proposal_container.test
    - proposal_provider.test
    - proposal_voter_set.test
    - region.test
    - roles.test
    - ticketing.test
  moduleArgs:
    common.init: *common_init
    common:
      allow_blockchain_dependencies: true
    proposal_blockchain.util:
      max_config_path_depth: 10
      max_config_size: 10240 # 10 KiB, low so we can test limits easier

libs:
  ft4:
    registry: https://bitbucket.org/chromawallet/ft3-lib
    path: rell/src/lib/ft4
    tagOrBranch: v0.1.6r
    rid: x"E83D84BBF4313ECDC609B74A6D1CF875FAB8062848502381348F5FC0775612E8"
    insecure: false
  auth:
    registry: https://bitbucket.org/chromawallet/auth-server-ft4.git
    path: rell/src/auth
    tagOrBranch: v1.1.0r
    rid: x"3CB605AC782EBD34C2212461CF76FF26F403E54095A424623358C15304D5B3C3"
    insecure: false
