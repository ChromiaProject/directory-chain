@test module;

import ^^.*;

struct module_args {
    admin_privkey: byte_array;
}

val admin_privkey = chain_context.args.admin_privkey;

function test_economy_constants() {
    val constants: economy_constants_data = get_economy_constants();
    assert_equals(constants.min_lease_time_weeks, 1);
    assert_equals(constants.max_lease_time_weeks, 12);
    assert_equals(constants.chr_per_usd, 5);
    assert_equals(constants.node_utilization_value_factor, 3);
    assert_equals(constants.node_value_vs_utilization_weight, 0.8);
    assert_equals(constants.provider_reward_share, 0.6);
    assert_equals(constants.system_provider_reward_share, 0.1);

    // Update constants
    rell.test.tx().op(
        update_economy_constants(1, 2, 3, 4, 5, 6, 7)
    ).run_must_fail("Expected admin signature");

    rell.test.tx().op(
        update_economy_constants(1, 2, 3, 4, 5, 6, 7)
    ).sign(admin_privkey).run();

    val updated_constants: economy_constants_data = get_economy_constants();
    assert_equals(updated_constants.min_lease_time_weeks, 1);
    assert_equals(updated_constants.max_lease_time_weeks, 2);
    assert_equals(updated_constants.chr_per_usd, 3);
    assert_equals(updated_constants.node_utilization_value_factor, 4);
    assert_equals(updated_constants.node_value_vs_utilization_weight, 5);
    assert_equals(updated_constants.provider_reward_share, 6);
    assert_equals(updated_constants.system_provider_reward_share, 7);
}